---
title: è½¯ä»¶å¼€å‘é¡¹ç›®å®è·µï¼ˆä¸‰ï¼‰
date: 2018-04-05 17:29:52
tags:
- Java
- Spring
---

ç»ˆäºåˆ°äº†å®éªŒä¸‰ï¼Œåæ§½ä¸€å¥ï¼Œç¯å¢ƒä¸ä¸€è‡´çœŸçš„å¾ˆéš¾å—ï¼Œåˆä¸æƒ³ç”¨Eclipseï¼Œè¿˜ä¸æƒ³é‡å†™ä¸€ä»½ï¼Œè¿™çœŸçš„æ˜¯å¾ˆéš¾åŠçš„äº‹æƒ…å‘¢ã€‚ğŸ™„

**1. å®ŒæˆPersistServiceå’ŒSelectServiceè¿™ä¸¤ä¸ªå®ç°ç±»ä¸­æ‰€æœ‰æ–¹æ³•ï¼Œå®šä¹‰ä»–ä»¬çš„æŠ½è±¡çˆ¶ç±»ï¼Œå¹¶æŠ½è±¡å‡ºå…¬å…±æ–¹æ³•ï¼Œä¸”ç”¨åˆ°æšä¸¾ã€‚**

æœ‰å¯èƒ½æˆ‘çœ‹æ¼äº†ï¼Œæˆ–è€…ç†è§£é”™æŠ¥å‘Šè¦æ±‚çš„æ„æ€äº†ï¼Œå…ˆè¿™ä¹ˆåšå§ã€‚

```Java

// persistService
@Override
public void updateStudent(StudentModel t, Integer id) {
	try {
		if (!super.checkWhitePermission(id)) {
			String string = String.format("è®°å½•%sæ— æ³•æ›´æ–°", id);
			logger.warn(string);
		}

		studentMapper.updateStudent(t, id);
		logger.info("è®°å½•" + id + "å·²ç»æ›´æ–°");

	} catch (Exception e) {
		logger.error("Error", e);
	}
}

// studentMapperTest
@Test
public void testUpdateStudent() {
  StudentModel studentModel = new StudentModel("ç‹äº”", "å¥³", "è½¯ä»¶äºŒç­", 1, 60 ,60 ,60, 60);
  persistService.updateStudent(studentModel, 1);
  logger.info("æ›´æ–°æˆåŠŸ");
}

```

æ²¡çœ‹åˆ°SelectServiceç±»é‡Œæœ‰å…¶å®ƒéœ€è¦å®ç°çš„ç±»ï¼Œä¹Ÿçœ‹äº†å…¶ç»§æ‰¿çš„ç±»å’Œæ¥å£ï¼ŒåŒæ ·éƒ½è¢«å®ç°è¿‡äº†ã€‚


**å®šä¹‰ä»–ä»¬çš„æŠ½è±¡çˆ¶ç±»ï¼Œå¹¶æŠ½è±¡å‡ºå…¬å…±æ–¹æ³•ï¼Œä¸”ç”¨åˆ°æšä¸¾**ï¼Œè¿™å‡ å¥è¯æƒ³äº†å¥½ä¹…ï¼Œæ²¡ææ‡‚ä»€ä¹ˆæ„æ€ï¼Œè™½ç„¶è¿™ä¸¤ä¸ªç±»éƒ½æœ‰åœ¨å¯¹StudentModelåšäº‹æƒ…ï¼Œä½†æ˜¯åŒºåˆ†åº¦å·²ç»å¾ˆå¤§äº†å“‡ï¼Œæ²¡ææ‡‚è¿˜èƒ½æŠ½å‡ºä»€ä¹ˆå…¬å…±æ–¹æ³•ï¼Œä½†æ˜¯çœ‹åˆ°äº†åè¾¹è¯´ **ä¸”éœ€è¦ç”¨åˆ°æšä¸¾** ï¼Œéš¾é“æ˜¯è¦æŠŠè¿™å‡ ä¸ªå¯¹StudentModelæ“ä½œçš„æ–¹æ³•éƒ½ç»Ÿä¸€åˆ°ä¸€ä¸ªçˆ¶ç±»é‡Œï¼Œç„¶åæ ¹æ®çˆ¶ç±»é‡Œçš„typeç±»å‹æšä¸¾å»åˆ¤æ–­å½“å‰å­ç±»æ˜¯å¦æœ‰â€œæƒé™â€å»æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Ÿæ€æ¥æƒ³å»ï¼Œè¿˜æ˜¯æ²¡ææ‡‚æ˜¯å•¥æ„æ€ã€‚å¾…åšæ±‚è§£ã€‚

**2. éªŒè¯è¯¾å ‚ä¸ŠAOPçš„ç›¸å…³æ ·ä¾‹ä»£ç ï¼Œç¼–å†™åœ¨è‡ªå·±ä¸šåŠ¡åœºæ™¯ä¸‹çš„é¢å‘åˆ‡é¢ç¨‹åºï¼ŒåŒ…æ‹¬before,after,around,After-Returningè¿™å››ç§é€šçŸ¥ã€‚**

è‡ªå·±è§‰å¾—Spring AOPæœ‰ç”¨åˆ°äº†ç±»ä¼¼JVMçš„runtimeå†…å®¹ï¼ˆå­˜ç²¹è‡ªå·±çš„çŒœæµ‹ï¼Œæ²¡æœ‰æŸ¥é˜…è¿‡ç›¸å…³èµ„æ–™ï¼‰ï¼Œåœ¨è¿è¡Œæ—¶åšäº†æ›¿æ¢ï¼Œæ¯”å¦‚è¯´AABBç±»åœ¨æ‰§è¡Œ`method()`ä¹‹å‰ï¼Œé€šè¿‡AOPçš„é…ç½®æ–‡ä»¶è¡¨æ˜æ˜¯ç”¨å“ªä¸ªç±»çš„å“ªä¸ªæ–¹æ³•åœ¨å“ªäº›ç±»çš„å“ªäº›æ–¹æ³•è¿è¡Œå‰ã€åç­‰æ—¶æœŸå…ˆæ‰§è¡Œï¼Œè¿™ç‚¹è·ŸOCä¸­çš„`Runtime`æ€è·¯éå¸¸çš„ç±»ä¼¼ï¼Œä½¿ç”¨AOPå¯ä»¥æœ‰ä¸¤ç§åšæ³•ï¼Œä¸€æ˜¯é€šè¿‡AOPç±»ä½¿ç”¨javaæ³¨è§£çš„æ–¹å¼è¡¨æ˜ï¼Œå¦å¤–ä¸€ç§æ˜¯åœ¨Springé…ç½®æ–‡ä»¶ä¸­å†™æ˜æ˜¯å“ªä¸ªç±»çš„å“ªä¸ªæ–¹æ³•éœ€è¦åœ¨ä»€ä¹ˆåœ°æ–¹è¢«æ‰§è¡Œï¼Œç»è¿‡ä¸€ç•ªæŠ˜è…¾ä¸‹æ¥ï¼Œä¸ªäººè§‰å¾—ä½¿ç”¨Springé…ç½®æ–‡ä»¶å†™æ˜åˆ‡é¢å‡½æ•°çš„è°ƒç”¨æ¯”è¾ƒå¥½ã€‚

è€å¸ˆä¸€ç›´æƒ³è®©æˆ‘ä»¬ç¼–å†™è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯ï¼Œè‡ªå·±çš„ä¸šåŠ¡åœºæ™¯ï¼Œä½†æ˜¯è½å®åˆ°å®å¤„å°±æ˜¯æƒ³è¦å»éªŒè¯AOPæ˜¯ä½ è‡ªå·±å†™çš„å˜›ï¼Œemmmï¼Œé‚£å°±ä¸Šdemoç¨‹åºå¥½äº†ã€‚

0. åˆ›å»ºSpringå·¥ç¨‹ï¼Œå¯¼å…¥é¢å¤–çš„[aopalliance.jar](http://www.java2s.com/Code/Jar/a/aopalliance.htm)å’Œ[aspectjweaver](http://mvnrepository.com/artifact/org.aspectj/aspectjweaver/1.8.7)åŒ…

1. åˆ›å»º`User`ç±»ï¼›

  ```java
  public class User {

      private Integer id;
      private String nickname;

      public Integer getId() {
          return id;
      }

      public void setId(Integer id) {
          this.id = id;
      }

      public String getNickname() {
          return nickname;
      }

      public void setNickname(String nickname) {
          this.nickname = nickname;
      }
  }

  ```

2. åˆ›å»º`UserMapper`ç±»ï¼Œå¯ä»¥ä¸ç”¨æ‰‹æ’¸SQLï¼Œè®©Mybatiså»åšï¼š

  ```java
  import java.util.List;

  public interface UserMapper {

      public User selectUserWithID(int ID) throws Exception;

  }

  ```

3. åˆ›å»º`selectUserAdvice`ç±»ï¼Œé‡Œè¾¹åŒ…å«äº†å¯¹Userç±»è¿›è¡Œæ“ä½œçš„æ‰€æœ‰åˆ‡é¢ç¨‹åºï¼š

	```java
	  public class userAdvice {

	    public void userSayHello() {
	      System.out.println("user say hello!");
	    }

	    public void userSayBay() {
	      System.out.println("user say bay!");
	    }

	    public void userSaySee() {
	      System.out.println("user say see!");
	    }

	    public void userSayUser(User user) {
	      System.out.println("user say " + user.nickname);
	    }

	  }

	```

4. é…ç½®User.xmlï¼Œä¾›MyBatisæ“ä½œuserè¡¨ï¼š
	```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="com.pjhubs.UserMapper">
    <select id="selectUserWithID" parameterType="int" resultType="com.pjhubs.User">
        select * from user where id = #{id}
    </select>
  </mapper>

  ```

5. é…ç½®SqlMapConfig.xmlï¼ŒMyBatisçš„é…ç½®æ–‡ä»¶ï¼š

  ```xml

  <?xml version="1.0" encoding="UTF-8" ?>
  <!DOCTYPE configuration
          PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
          "http://mybatis.org/dtd/mybatis-3-config.dtd">
  <configuration>
      <environments default="development">
          <environment id="development">
              <transactionManager type="JDBC"/>
              <dataSource type="POOLED">
                  <property name="driver" value="com.mysql.jdbc.Driver"/>
                  <property name="url" value="jdbc:mysql://localhost:3306/mybatis?useSSL=false"/>
                  <property name="username" value="your DB name"/>
                  <property name="password" value="your DB password"/>
              </dataSource>
          </environment>
      </environments>
      <mappers>
          <mapper resource="User.xml"/>
      </mappers>
  </configuration>

  ```

6. åˆ›å»ºSpringé…ç½®æ–‡ä»¶ï¼ˆintelliJåœ¨åˆ›å»ºSpringå·¥ç¨‹çš„æ—¶å€™å¯è¿›è¡Œå‹¾é€‰ååŠ©åˆ›å»ºï¼‰ï¼Œå¹¶å†™ä¸‹ï¼Œï¼ˆå‚è€ƒå®éªŒæ–‡æ¡£ä¸­å†…å®¹ï¼‰ï¼š

	```xml

	  <?xml version="1.0" encoding="UTF-8"?>
	  <beans xmlns="http://www.springframework.org/schema/beans"
	  	xmlns:task="http://www.springframework.org/schema/task" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	  	xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx"
	  	xmlns:util="http://www.springframework.org/schema/util" xmlns:p="http://www.springframework.org/schema/p"
	  	xmlns:cache="http://www.springframework.org/schema/cache"
	  	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
	  	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
	          http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
	  	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd
	  	http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd
	  	http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd">


	    <bean id="user" class="com.pjhubs.user" />
	    <bean id="userAdvice" class="com.pjhubs.userAdvice" />

	  	<aop:config proxy-target-class="true">
	  		<aop:pointcut id="selectUser" expression="target(com.pjhubs.user) and execution(* select*(..))" />
	  		  <aop:aspect id="userAdvice" ref="userAdvice">
	  			  <aop:before method="userSayHello" pointcut-ref="selectUser" />
	  			  <aop:around method="userSayBay" pointcut-ref="selectUser" />
	    			<aop:after method="userSaySee" pointcut-ref="selectUser" />
	    			<aop:after-returning method="userSayUser" pointcut-ref="selectUser" returning="bindParam" />
	  		</aop:aspect>
	  	</aop:config>

	  </beans>

  ```

7. æµ‹è¯•ã€‚åŒæ—¶ä¹Ÿåœ¨åšç¬¬ä¸‰é¢˜â€”â€”ï¼ˆ**åˆ©ç”¨Springæ¡†æ¶çš„å•å…ƒæµ‹è¯•è·‘é€šä»¥ä¸Šæ‰€æœ‰æ–¹æ³•ã€‚**ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å¼•å…¥äº†Springï¼Œæ‰€ä»¥å°±ä¸è¦å†åªæ˜¯ä½¿ç”¨JUnitå•¦~éœ€è¦åŒæ—¶å¼•å…¥ä»¥ä¸‹jaråŒ…ï¼Œ
  * JUnit4
  * Spring-Test
  æœ¬ç€èµ¶ç´§åšå®Œçš„å¿ƒæ€ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨Mavenç­‰ä¾èµ–å·¥å…·å¯¹javaå·¥ç¨‹çš„å„ç§ä¾èµ–åŒ…è¿›è¡Œç®¡ç†ğŸ™‚ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šå¯¹å…¶æ‰‹åŠ¨æ·»åŠ jaråŒ…ã€‚emmmã€‚åˆ›å»ºæµ‹è¯•ç±»`userTest`:

  ```java

  @RunWith(SpringJUnit4ClassRunner.class)
  @ContextConfiguration("/spring-config.xml")

  public class userTest() {
    @Resource
    public User user;

    @Test
    public void testSelectUser() {
      User user = userMapper.selectUserWithID(2);
      System.out.println("id:" + user.getId() + " æ˜µç§°ï¼š" + user.getNickname());
    }
  }

  ```



## å¦‚æœä½ å«Œå¼ƒä¸Šè¾¹è¯´çš„å¤ªå•°å—¦ï¼Œé‚£ä¹ˆè¿™è¿˜æœ‰ä¸ªç®€çº¦ç‰ˆçš„ã€‚

é¦–å…ˆåœ¨intelliJä¸‹åˆ›å»ºä¸€ä¸ªSpringå·¥ç¨‹ï¼Œå½“ç„¶è¦ä½ çš„intelliJæ˜¯ç¤¾åŒºç‰ˆçš„å°±ç®—äº†ï¼ŒåŠŸèƒ½æ”¯æŒçš„å—é™ã€‚è®°å¾—å‹¾é€‰åˆ›å»ºé»˜è®¤çš„Spring XMLé…ç½®æ–‡ä»¶ã€‚

### éªŒè¯IOCç›¸å…³å†…å®¹ï¼Œéšæ„åˆ›å»ºä¸€ä¸ªç±»ï¼Œåœ¨å…¶ä¸­éšæ„å†™ä¸‹ä¸€ä¸ªæ–¹æ³•ï¼Œ

```java
public class IOCTest {

    private String IOCName;


    public String getIOCName() {
        return IOCName;
    }

    public void setIOCName(String IOCName) {
        this.IOCName = IOCName;
    }

    public void printIOCName() {
        System.out.println(IOCName);
    }
}

```

2. åœ¨å·¥ç¨‹é»˜è®¤ç”Ÿæˆçš„Spring XMLé…ç½®æ–‡ä»¶ä¸­ï¼Œæ–°å¢ï¼Œ

	```Java
	<bean id="IOCTest" class="IOCTest">
		<property name="IOCName" value="pjhubs"></property>
	</bean>
	```

3. åœ¨Mainç±»ä¸­æˆ–è€…æ–°å»ºä¸€ä¸ªæµ‹è¯•ç±»çš„æµ‹è¯•æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å†™ä¸‹ï¼Œ

```java
public class Main {
    public static void main(String[] args) {
        ApplicationContext context=new ClassPathXmlApplicationContext("spring-config.xml");
        IOCTest iocTest = (IOCTest)context.getBean("IOCTest");
        iocTest.printIOCName();
    }
}  
```

è¿™æ ·å°±å®Œæˆäº†IOCçš„å†…å®¹ï¼ŒæŠŠåˆ›å»ºå¯¹è±¡çš„èƒ½åŠ›â€œè½¬ç§»â€æ‰äº†ï¼ŒåŒæ—¶ä¹Ÿè¾¾åˆ°äº†æˆ‘ä»¬åªéœ€è¦å®šä¹‰æ¥å£ï¼Œç›¸å…³ç±»çš„æ§åˆ¶äº¤ç”±IOCç®¡ç†å³å¯ï¼Œè€Œä¸”å½“æˆ‘ä»¬æœ‰éœ€è¦å¯¹ä¸¤ä¸ªç±»å®šä¹‰å…³ç³»æ—¶ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰å¥½å³å¯ã€‚

### éªŒè¯AOCçš„ç›¸å…³å†…å®¹

1. åˆ›å»ºå¥½å·¥ç¨‹åï¼Œåœ¨[è¿™ä¸ªåœ°å€](http://www.java2s.com/Code/Jar/a/Downloadaspectjweaver172jar.htm)ä¸‹è½½`aspectjweaver`åŒ…ï¼Œå¯¼å…¥å·¥ç¨‹ã€‚

2. åˆ†åˆ«åˆ›å»ºä¸¤ä¸ªç±»ï¼Œæœ¬æ¬¡æˆ‘ä»¬é‡‡ç”¨XMLæ–‡ä»¶é…ç½®çš„æ–¹å¼æ¥åšAOPï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ

	```Java
		public class AOPTest {

	    public void AOPTest() {
	        System.out.println("AOPTest......");
	    }

		}

	```

	```Java

	import org.aspectj.lang.ProceedingJoinPoint;

	public class AOPMethon {

	    //å‰ç½®å¢å¼º
	    public void before(){
	        System.out.println("å‰ç½®å¢å¼º........");
	    }

	    //åç½®å¢å¼º
	    public void after(){
	        System.out.println("åç½®å¢å¼º........");
	    }

	    //ç¯ç»•å¢å¼º
	    public void arround(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
	        //æ–¹æ³•ä¹‹å‰æ‰§è¡Œçš„ä»£ç 
	        System.out.println("ç¯ç»•å¢å¼º æ–¹æ³•ä¹‹å‰æ‰§è¡Œ........");

	        //æ‰§è¡Œè¢«å¢å¼ºçš„æ–¹æ³•
	        proceedingJoinPoint.proceed();

	        //æ–¹æ³•ä¹‹åæ‰§è¡Œçš„ä»£ç 
	        System.out.println("ç¯ç»•å¢å¼º æ–¹æ³•ä¹‹åæ‰§è¡Œ........");
	    }

	}

	```

3. ä¿®æ”¹Spring XMLé…ç½®æ–‡ä»¶ä¸ºï¼Œ

	```XML
	<?xml version="1.0" encoding="UTF-8"?>
	<beans xmlns="http://www.springframework.org/schema/beans"
	       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd">

	    <!--1 é…ç½®å¯¹è±¡-->
	    <bean class="AOPMethon" id="AOPMethon"></bean>
	    <bean class="AOPTest" id="AOPTest"></bean>

	    <!--2 é…ç½®AOPæ“ä½œ-->
	    <aop:config>
	        <!--é…ç½®åˆ‡å…¥ç‚¹-->
	        <aop:pointcut id="pointcut" expression="execution(* AOPTest.AOPTest())"/>
	        <!--é…ç½®åˆ‡é¢
	            æŠŠå¢å¼ºç”¨åˆ°æ–¹æ³•ä¸Šé¢
	        -->
	        <aop:aspect ref="AOPMethon">
	            <!--å‰ç½®å¢å¼º-->
	            <aop:before method="before" pointcut-ref="pointcut"/>

	            <!--åç½®å¢å¼º-->
	            <aop:after-returning method="after" pointcut-ref="pointcut"/>

	            <!--ç¯ç»•å¢å¼º-->
	            <aop:around method="arround" pointcut-ref="pointcut"/>
	        </aop:aspect>
	    </aop:config>

	</beans>
	```

4. æ–°å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œå†™ä¸‹ç›¸å…³çš„æµ‹è¯•æ–¹æ³•ï¼Œ

	```Java
	import org.junit.Test;
	import org.springframework.context.ApplicationContext;
	import org.springframework.context.support.ClassPathXmlApplicationContext;

	public class test {
	    @Test
	    public void AOPTest() {
	        ApplicationContext applicationContext = new ClassPathXmlApplicationContext("spring-config.xml");
	        AOPTest aopTest = (AOPTest) applicationContext.getBean("AOPTest");
	        aopTest.AOPTest();
	    }
}

	```

5. è¾“å‡ºçš„ç»“æœä¸ºï¼š
	```
		å‰ç½®å¢å¼º........
		ç¯ç»•å¢å¼º æ–¹æ³•ä¹‹å‰æ‰§è¡Œ........
		AOPTest......
		ç¯ç»•å¢å¼º æ–¹æ³•ä¹‹åæ‰§è¡Œ........
		åç½®å¢å¼º........
	```

è‡³äºAOPä¸­çš„è¿™å‡ ä¸ªå¢å¼ºæ–¹æ³•çš„åŒºåˆ«ï¼Œå°±ä¸å±•å¼€å•¦~~~
